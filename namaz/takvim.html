<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Namaz Takvimi - Furkan</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .location-header { color: #10b981; font-size: 20px; font-weight: bold; margin-bottom: 15px; text-align: center; }
        .table-wrapper { background: #1e293b; border-radius: 20px; padding: 5px; overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; color: #f8fafc; min-width: 450px; }
        th { background: #0f172a; color: #94a3b8; padding: 10px; font-size: 11px; text-transform: uppercase; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #334155; font-size: 14px; }
        .today-row { background: rgba(16, 185, 129, 0.2); color: #10b981; font-weight: bold; }
        .error-msg { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; color: #ef4444; padding: 15px; border-radius: 15px; text-align: center; margin: 20px 0; display: none; }
    </style>
</head>
<body>

<div class="mobile-container">
    <div class="app-header">
        <h1>Namaz Takvimi</h1>
        <div id="location-display" class="location-header">YÃ¼kleniyor...</div>
    </div>

    <div id="error-box" class="error-msg">
        âš ï¸ ÃœzgÃ¼nÃ¼z, bu bÃ¶lge iÃ§in vakit verisi ÅŸu an API tarafÄ±ndan saÄŸlanamÄ±yor. 
        LÃ¼tfen geri dÃ¶nÃ¼p en yakÄ±n bÃ¼yÃ¼k ÅŸehri seÃ§in.
    </div>

    <div class="table-wrapper" id="table-area">
        <table>
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Ä°msak</th>
                    <th>Ã–ÄŸle</th>
                    <th>Ä°kindi</th>
                    <th>AkÅŸam</th>
                    <th>YatsÄ±</th>
                </tr>
            </thead>
            <tbody id="calendar-body"></tbody>
        </table>
    </div>

    <button class="btn-primary" style="background:#334155;" onclick="window.location.href='index.html'">â¬… Geri DÃ¶n / BÃ¶lge DeÄŸiÅŸtir</button>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    const locName = params.get('name');

    if(locName) document.getElementById('location-display').innerText = "ğŸ“ " + locName;

    if(id) {
        // API klasÃ¶rÃ¼nden ilgili JSON dosyasÄ±nÄ± Ã§ekmeye Ã§alÄ±ÅŸ
        fetch(`api/vakitler/${id}.json`)
            .then(res => {
                if(!res.ok) throw new Error("Dosya bulunamadÄ±");
                return res.json();
            })
            .then(data => {
                let html = '';
                const bugun = new Date().toLocaleDateString('tr-TR');
                const limit = new Date(2026, 2, 11); // 10 Mart 2026 sÄ±nÄ±rÄ±

                data.forEach(v => {
                    const p = v.MiladiTarihKisa.split('.');
                    const vDate = new Date(p[2], p[1]-1, p[0]);

                    if (vDate < limit) {
                        const isToday = v.MiladiTarihKisa === bugun ? 'class="today-row"' : '';
                        html += `<tr ${isToday}>
                            <td>${v.MiladiTarihKisa.split('.')[0]} ${v.KameriTarihKisa.split(' ')[1]}</td>
                            <td>${v.Imsak}</td>
                            <td>${v.Ogle}</td>
                            <td>${v.Ikindi}</td>
                            <td>${v.Aksam}</td>
                            <td>${v.Yatsi}</td>
                        </tr>`;
                    }
                });
                document.getElementById('calendar-body').innerHTML = html;
            })
            .catch(err => {
                // EÄŸer dosya (vakitler/ID.json) yoksa burasÄ± Ã§alÄ±ÅŸÄ±r
                document.getElementById('table-area').style.display = 'none';
                document.getElementById('error-box').style.display = 'block';
                document.getElementById('location-display').innerText = "Veri BulunamadÄ±";
            });
    }
</script>
</body>
</html>
